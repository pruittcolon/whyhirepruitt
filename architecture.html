<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture - Pruitt Colon</title>
  <meta name="description" content="Technical deep-dive into the NeMo AI Platform architecture.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="css/design-system.css">
  <style>
    /* Architecture Hero */
    .arch-hero {
      padding: var(--space-40) 0 var(--space-16);
      position: relative;
      overflow: hidden;
    }

    .arch-intro {
      max-width: 640px;
    }

    .arch-intro h1 {
      font-size: clamp(2.5rem, 5vw, 3.5rem);
      font-weight: var(--weight-bold);
      letter-spacing: var(--tracking-tight);
      margin-bottom: var(--space-4);
    }

    .arch-intro p {
      font-size: var(--text-lg);
      color: var(--text-secondary);
      line-height: var(--leading-relaxed);
    }

    /* Visual Architecture Diagram - SVG Overlay Based */
    .arch-visual-section {
      padding: var(--space-16) 0 var(--space-24);
    }

    .section-label {
      font-size: var(--text-xs);
      font-weight: var(--weight-medium);
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: var(--tracking-wider);
      margin-bottom: var(--space-4);
    }

    .section-title {
      font-size: var(--text-2xl);
      font-weight: var(--weight-semibold);
      margin-bottom: var(--space-3);
    }

    .section-desc {
      color: var(--text-secondary);
      max-width: 600px;
      margin-bottom: var(--space-10);
    }

    /* New Diagram Styles */
    .arch-diagram {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-2xl);
      padding: var(--space-10);
      box-shadow: var(--shadow-sm);
      overflow-x: auto;
      /* Allow scrolling if it gets too wide */
      position: relative;
    }

    .diagram-layers {
      display: flex;
      flex-direction: column;
      gap: 100px;
      /* Increased gap for clear lines */
      min-width: 1000px;
      /* Ensure enough width */
      position: relative;
      z-index: 2;
      align-items: center;
      /* Center everything */
    }

    .diagram-layer {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      position: relative;
      width: 100%;
      justify-content: center;
    }

    .layer-label {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 80px;
      font-size: var(--text-xs);
      font-weight: var(--weight-medium);
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: var(--tracking-wider);
    }

    .layer-content {
      display: flex;
      /* Default flex */
      gap: var(--space-6);
      justify-content: center;
      position: relative;
    }

    /* Grid for Services to prevent messy wrapping */
    #layer-services .layer-content {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-8);
      /* wider gap */
    }

    .diagram-node {
      padding: var(--space-4) var(--space-6);
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      text-align: center;
      transition: all var(--duration-fast) var(--ease-out);
      position: relative;
      z-index: 2;
      min-width: 160px;
      background-clip: padding-box;
      /* Cleaner borders */
    }

    .diagram-node:hover {
      border-color: var(--border-hover);
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
      background: var(--bg-elevated);
    }

    /* Node States */
    .diagram-node.active-pulse {
      animation: pulse 2s infinite;
      border-color: var(--success);
      color: var(--text-primary);
    }

    .diagram-node.gateway {
      border-color: rgba(22, 163, 74, 0.3);
      background: rgba(22, 163, 74, 0.05);
    }

    .diagram-node.gpu-node {
      border-color: rgba(139, 92, 246, 0.3);
      background: rgba(139, 92, 246, 0.05);
    }

    .node-name {
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      margin-bottom: var(--space-1);
    }

    .node-desc {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
    }

    .node-port {
      display: inline-block;
      margin-top: var(--space-2);
      padding: 2px 8px;
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--text-tertiary);
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
    }

    /* SVG Overlay */
    .svg-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    .connector-path {
      fill: none;
      stroke: var(--border);
      stroke-width: 1.5;
      opacity: 0.6;
      transition: stroke 0.3s ease, opacity 0.3s ease, stroke-width 0.3s ease;
    }

    .connector-path.active {
      stroke: var(--success);
      stroke-width: 2.5;
      opacity: 1;
      stroke-dasharray: 10;
      animation: flow 1s linear infinite;
    }

    /* Services Grid */
    .services-section {
      padding: var(--space-16) 0;
      background: var(--bg-secondary);
    }

    .services-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-5);
    }

    @media (max-width: 768px) {
      .services-grid {
        grid-template-columns: 1fr;
      }
    }

    .service-card {
      padding: var(--space-6);
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      transition: all var(--duration-fast) var(--ease-out);
    }

    .service-card:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .service-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-3);
    }

    .service-name {
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
    }

    .service-port {
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      padding: var(--space-1) var(--space-2);
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
    }

    .service-desc {
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: var(--leading-relaxed);
    }

    /* ML Engines Section */
    .engines-section {
      padding: var(--space-16) 0;
    }

    .engine-category {
      margin-bottom: var(--space-10);
    }

    .engine-category:last-child {
      margin-bottom: 0;
    }

    .category-title {
      font-size: var(--text-sm);
      font-weight: var(--weight-medium);
      color: var(--text-tertiary);
      margin-bottom: var(--space-4);
      padding-bottom: var(--space-2);
      border-bottom: 1px solid var(--border);
    }

    .engines-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: var(--space-3);
    }

    .engine-item {
      padding: var(--space-3) var(--space-4);
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      color: var(--text-secondary);
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      text-align: center;
      transition: all var(--duration-fast) var(--ease-out);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .engine-item:hover {
      border-color: var(--border-hover);
      background: var(--bg-secondary);
      transform: translateY(-2px);
    }

    /* K8s Section - Keeping original styling */
    .k8s-section {
      padding: var(--space-16) 0;
      background: var(--bg-secondary);
    }

    .k8s-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-6);
    }

    @media (max-width: 900px) {
      .k8s-grid {
        grid-template-columns: 1fr;
      }
    }

    .k8s-card {
      padding: var(--space-6);
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
    }

    .k8s-card h4 {
      font-size: var(--text-base);
      font-weight: var(--weight-medium);
      margin-bottom: var(--space-4);
    }

    .k8s-list {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    .k8s-list li {
      padding: var(--space-2) 0;
      padding-left: var(--space-4);
      position: relative;
      border-bottom: 1px solid var(--border);
    }

    .k8s-list li::before {
      content: ">";
      position: absolute;
      left: 0;
      color: var(--text-tertiary);
      font-family: var(--font-mono);
      font-size: var(--text-xs);
    }

    /* Decorative */
    .decorative-line {
      width: 60px;
      height: 1px;
      background: var(--border-hover);
      margin-bottom: var(--space-6);
    }
  </style>
</head>

<body>
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-brand">Pruitt Colon</a>
      <button class="nav-toggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="architecture.html" class="nav-link active">Architecture</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="demo/index.html" class="nav-link">Demo</a>
        <a href="contact.html" class="nav-link">Contact</a>
      </div>
    </div>
  </nav>

  <main>
    <section class="arch-hero">
      <div class="container">
        <div class="arch-intro reveal">
          <h1>Architecture</h1>
          <p>A technical deep-dive into the NeMo AI Platform architecture: 12 distributed services, 37 specialized ML
            engines, full Kubernetes
            deployment with Istio service mesh,
            all orchestrated on a single consumer GPU.</p>
        </div>
      </div>
    </section>

    <section class="arch-visual-section">
      <div class="container">
        <div class="decorative-line"></div>
        <span class="section-label">System Overview</span>
        <h2 class="section-title">How It Works</h2>
        <p class="section-desc">A layered architecture designed for GPU efficiency and real-time processing.</p>

        <div class="arch-diagram reveal">

          <!-- SVG Overlay for Connectors -->
          <svg class="svg-overlay" id="diagram-connections">
            <!-- Paths will be drawn dynamically via JS to match node positions -->
          </svg>

          <div class="diagram-layers">
            <!-- Client Layer -->
            <div class="diagram-layer" id="layer-clients">
              <span class="layer-label">Clients</span>
              <div class="layer-content">
                <div class="diagram-node" id="node-frontend">
                  <div class="node-name">Web Frontend</div>
                  <div class="node-desc">20+ pages</div>
                </div>
                <div class="diagram-node" id="node-mobile">
                  <div class="node-name">Flutter Mobile</div>
                  <div class="node-desc">Cross-platform</div>
                </div>
              </div>
            </div>

            <!-- Gateway Layer -->
            <div class="diagram-layer" id="layer-gateway">
              <span class="layer-label">Gateway</span>
              <div class="layer-content">
                <div class="diagram-node gateway" id="node-nginx">
                  <div class="node-name">NGINX</div>
                  <div class="node-desc">TLS Termination</div>
                  <span class="node-port">:443</span>
                </div>
                <div class="diagram-node gateway" id="node-api">
                  <div class="node-name">API Gateway</div>
                  <div class="node-desc">Auth / Limits</div>
                  <span class="node-port">:8000</span>
                </div>
              </div>
            </div>

            <!-- Services Layer (Grid Layout) -->
            <div class="diagram-layer" id="layer-services">
              <span class="layer-label">Services</span>
              <div class="layer-content">
                <!-- Row 1: Core AI -->
                <div class="diagram-node" id="node-gemma">
                  <div class="node-name">Gemma</div>
                  <div class="node-desc">LLM AI</div>
                  <span class="node-port">:8001</span>
                </div>
                <div class="diagram-node" id="node-transcribe">
                  <div class="node-name">Transcription</div>
                  <div class="node-desc">ASR</div>
                  <span class="node-port">:8003</span>
                </div>
                <div class="diagram-node" id="node-rag">
                  <div class="node-name">RAG</div>
                  <div class="node-desc">Context</div>
                  <span class="node-port">:8004</span>
                </div>
                <div class="diagram-node" id="node-emotion">
                  <div class="node-name">Emotion</div>
                  <div class="node-desc">Analysis</div>
                  <span class="node-port">:8005</span>
                </div>

                <!-- Row 2: Integration -->
                <div class="diagram-node" id="node-ml">
                  <div class="node-name">ML Service</div>
                  <div class="node-desc">37 Engines</div>
                  <span class="node-port">:8006</span>
                </div>
                <div class="diagram-node" id="node-insights">
                  <div class="node-name">Insights</div>
                  <div class="node-desc">Analytics</div>
                  <span class="node-port">:8010</span>
                </div>
                <div class="diagram-node" id="node-fiserv">
                  <div class="node-name">Fiserv</div>
                  <div class="node-desc">Banking</div>
                  <span class="node-port">:8015</span>
                </div>
                <div class="diagram-node" id="node-n8n">
                  <div class="node-name">N8N</div>
                  <div class="node-desc">Automation</div>
                  <span class="node-port">:8011</span>
                </div>
              </div>
            </div>

            <!-- GPU / Infra Layer -->
            <div class="diagram-layer" id="layer-infra">
              <span class="layer-label">Infra</span>
              <div class="layer-content">
                <div class="diagram-node gpu-node" id="node-gpu">
                  <div class="node-name">GPU Coordinator</div>
                  <div class="node-desc">Queue Service</div>
                  <span class="node-port">:8002</span>
                </div>
                <div class="diagram-node" id="node-redis">
                  <div class="node-name">Redis</div>
                  <div class="node-desc">Cache/Locks</div>
                  <span class="node-port">:6379</span>
                </div>
                <div class="diagram-node" id="node-postgres">
                  <div class="node-name">PostgreSQL</div>
                  <div class="node-desc">Persistence</div>
                  <span class="node-port">:5432</span>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <section class="services-section">
      <div class="container">
        <div class="decorative-line"></div>
        <span class="section-label">Core Services</span>
        <h2 class="section-title">12 Microservices</h2>
        <p class="section-desc">10 application services + 2 infrastructure services working in concert, all Dockerized.
        </p>

        <div class="services-grid">
          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">api-gateway</span>
              <span class="service-port">:8000</span>
            </div>
            <p class="service-desc">Central entry point handling JWT auth, request routing, rate limiting, and WebSocket
              connections for real-time updates.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">gemma-service</span>
              <span class="service-port">:8001</span>
            </div>
            <p class="service-desc">Conversational AI powered by Gemma 3 4B (Q4 quantized). Integrates RAG context,
              emotional awareness, and business analysis.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">queue-service (GPU Coord)</span>
              <span class="service-port">:8002</span>
            </div>
            <p class="service-desc">VRAM orchestration via Redis semaphores. Manages model loading, memory allocation,
              and preemptive pausing between Gemma and ASR.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">transcription-service</span>
              <span class="service-port">:8003</span>
            </div>
            <p class="service-desc">Real-time ASR using Parakeet RNNT 0.6b. Includes speaker diarization (Sortformer)
              and
              streaming audio processing.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">rag-service</span>
              <span class="service-port">:8004</span>
            </div>
            <p class="service-desc">Retrieval-augmented generation with FAISS vector storage. Handles conversation
              memory and knowledge bases.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">emotion-service</span>
              <span class="service-port">:8005</span>
            </div>
            <p class="service-desc">Multi-dimensional emotion analysis using fine-tuned DistilRoBERTa. Provides
              sentiment scoring and temporal tracking.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">ml-service</span>
              <span class="service-port">:8006</span>
            </div>
            <p class="service-desc">"System 2" thinking with 37 specialized engines. Titan AutoML, Oracle Causal, Newton
              Symbolic, Salesforce CRM analytics, and more.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">insights-service</span>
              <span class="service-port">:8010</span>
            </div>
            <p class="service-desc">Analytics and AutoML experiments. Revenue forecasting, anomaly detection, and
              business intelligence visualization.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">nginx</span>
              <span class="service-port">:443</span>
            </div>
            <p class="service-desc">HTTPS reverse proxy with TLS 1.3 termination. Handles SSL certificates, security
              headers, and load balancing.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">n8n-service</span>
              <span class="service-port">:8011</span>
            </div>
            <p class="service-desc">Voice command integration and smart home automation. Connects to Voice Monkey for
              Alexa control.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">fiserv-service</span>
              <span class="service-port">:8015</span>
            </div>
            <p class="service-desc">Banking hub integrating with Fiserv API for account data, transactions, and
              financial analytics.</p>
          </div>

          <div class="service-card reveal">
            <div class="service-header">
              <span class="service-name">redis + postgres</span>
              <span class="service-port">Infra</span>
            </div>
            <p class="service-desc">Persistence layer. Redis for high-speed caching and locks; PostgreSQL for durable
              data and task queues.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="engines-section">
      <div class="container">
        <div class="decorative-line"></div>
        <span class="section-label">ML Capabilities</span>
        <h2 class="section-title">37 Specialized ML Engines</h2>
        <p class="section-desc">A comprehensive suite of analytical engines powered by the ML Service.</p>

        <div class="engine-category reveal">
          <h4 class="category-title">Core AI Models</h4>
          <div class="engines-grid">
            <div class="engine-item">Gemma 3 4B</div>
            <div class="engine-item">Parakeet ASR</div>
            <div class="engine-item">TitaNet Speaker</div>
            <div class="engine-item">DistilRoBERTa (Emotion)</div>
            <div class="engine-item">MiniLM Embeddings</div>
            <div class="engine-item">Sortformer Diarization</div>
          </div>
        </div>

        <div class="engine-category reveal">
          <h4 class="category-title">AutoML & Predictive (Titan Series)</h4>
          <div class="engines-grid">
            <div class="engine-item">Titan AutoML</div>
            <div class="engine-item">Oracle Causal</div>
            <div class="engine-item">Newton Symbolic</div>
            <div class="engine-item">Chronos Temporal</div>
            <div class="engine-item">Galileo Geometric</div>
            <div class="engine-item">Scout Discovery</div>
            <div class="engine-item">Predictive Engine</div>
            <div class="engine-item">Statistical Engine</div>
            <div class="engine-item">Trend Engine</div>
          </div>
        </div>

        <div class="engine-category reveal">
          <h4 class="category-title">Financial Analysis</h4>
          <div class="engines-grid">
            <div class="engine-item">Revenue Forecast</div>
            <div class="engine-item">Cash Flow</div>
            <div class="engine-item">Budget Variance</div>
            <div class="engine-item">Profit Margin</div>
            <div class="engine-item">Cost Optimization</div>
            <div class="engine-item">Pricing Strategy</div>
            <div class="engine-item">ROI Prediction</div>
            <div class="engine-item">Inventory Optimization</div>
          </div>
        </div>

        <div class="engine-category reveal">
          <h4 class="category-title">Advanced Analytics</h4>
          <div class="engines-grid">
            <div class="engine-item">Chaos Non-Linear</div>
            <div class="engine-item">Anomaly Detector</div>
            <div class="engine-item">Clustering Engine</div>
            <div class="engine-item">Customer LTV</div>
            <div class="engine-item">Market Basket</div>
            <div class="engine-item">Spend Pattern</div>
            <div class="engine-item">Deep Feature</div>
            <div class="engine-item">Universal Graph</div>
            <div class="engine-item">Flash Inference</div>
            <div class="engine-item">Mirror Synthetic</div>
            <div class="engine-item">RAG Evaluation</div>
            <div class="engine-item">Quality Insights</div>
          </div>
        </div>

        <div class="engine-category reveal">
          <h4 class="category-title">Salesforce CRM Analytics</h4>
          <div class="engines-grid">
            <div class="engine-item">Churn Prediction</div>
            <div class="engine-item">Next Best Action</div>
            <div class="engine-item">Deal Velocity</div>
            <div class="engine-item">Competitive Intel</div>
            <div class="engine-item">Customer 360</div>
            <div class="engine-item">Lead Scoring</div>
            <div class="engine-item">Opportunity Score</div>
          </div>
        </div>
      </div>
    </section>

    <section class="k8s-section">
      <div class="container">
        <div class="decorative-line"></div>
        <span class="section-label">Deployment</span>
        <h2 class="section-title">Kubernetes Ready</h2>
        <p class="section-desc">Production-ready K8s manifests with NVIDIA GPU passthrough</p>

        <div class="k8s-grid">
          <div class="k8s-card reveal">
            <h4>Manifests</h4>
            <ul class="k8s-list">
              <li>namespace.yaml</li>
              <li>secrets.yaml (12 keys)</li>
              <li>services.yaml (ClusterIP)</li>
              <li>deployments.yaml (842 lines)</li>
              <li>ingress.yaml (NGINX)</li>
              <li>nvidia-device-plugin.yaml</li>
            </ul>
          </div>

          <div class="k8s-card reveal">
            <h4>GPU Passthrough</h4>
            <ul class="k8s-list">
              <li>NVIDIA Device Plugin DaemonSet</li>
              <li>Direct device mounts (/dev/nvidia*)</li>
              <li>CUDA runtime in containers</li>
              <li>Resource limits: nvidia.com/gpu: 1</li>
              <li>Shared GPU across pods</li>
            </ul>
          </div>

          <div class="k8s-card reveal">
            <h4>Kustomize Overlays</h4>
            <ul class="k8s-list">
              <li>base/ (common resources)</li>
              <li>overlays/local/ (dev)</li>
              <li>overlays/install/ (prod)</li>
              <li>Health check probes</li>
              <li>Init containers for setup</li>
            </ul>
          </div>

          <div class="k8s-card reveal">
            <h4>Istio Service Mesh</h4>
            <ul class="k8s-list">
              <li>VirtualService routing</li>
              <li>DestinationRule policies</li>
              <li>Gateway TLS termination</li>
              <li>mTLS between services</li>
              <li>Traffic management</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <a href="index.html" class="nav-brand">Pruitt Colon</a>
          <p class="subtitle" style="margin-top: 8px;">Senior Software Engineer</p>
        </div>
        <div class="footer-links">
          <a href="https://github.com/pruittcolon" class="footer-social" aria-label="GitHub">GH</a>
          <a href="https://linkedin.com/in/pruittcolon" class="footer-social" aria-label="LinkedIn">LI</a>
          <a href="contact.html" class="footer-contact-btn">Get in Touch</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p class="footer-text">&copy; 2024 Pruitt Colon. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <script>
    // Smooth Connector Drawing Script
    document.addEventListener('DOMContentLoaded', () => {
      const svg = document.getElementById('diagram-connections');

      const connections = [
        // Frontend -> Gateway
        ['node-frontend', 'node-nginx'],
        ['node-mobile', 'node-nginx'],
        ['node-nginx', 'node-api'],

        // API -> Core AI (Row 1)
        ['node-api', 'node-gemma'],
        ['node-api', 'node-transcribe'],
        ['node-api', 'node-rag'],
        ['node-api', 'node-emotion'],

        // API -> Integration (Row 2)
        ['node-api', 'node-ml'],
        ['node-api', 'node-insights'],
        ['node-api', 'node-fiserv'],
        ['node-api', 'node-n8n'],

        // Dependencies
        ['node-gemma', 'node-gpu'],     // Gemma -> GPU
        ['node-transcribe', 'node-gpu'], // Transcribe -> GPU
        ['node-ml', 'node-gpu'],         // ML -> GPU

        ['node-gemma', 'node-rag'],      // Context
        ['node-transcribe', 'node-emotion'], // Audio

        // Infra
        ['node-gpu', 'node-redis'],      // Coordinator -> Redis
        ['node-ml', 'node-postgres']     // ML -> Postgres
      ];

      function drawConnections() {
        svg.innerHTML = ''; // Clear existing
        const containerRect = document.querySelector('.diagram-layers').getBoundingClientRect();

        // Configure SVG 
        svg.setAttribute('width', containerRect.width);
        svg.setAttribute('height', containerRect.height);

        connections.forEach(([startId, endId]) => {
          const startEl = document.getElementById(startId);
          const endEl = document.getElementById(endId);

          if (!startEl || !endEl) return;

          const startRect = startEl.getBoundingClientRect();
          const endRect = endEl.getBoundingClientRect();

          // Calculate relative coordinates
          const x1 = startRect.left + startRect.width / 2 - containerRect.left;
          const y1 = startRect.bottom - containerRect.top; // Start from bottom
          const x2 = endRect.left + endRect.width / 2 - containerRect.left;
          const y2 = endRect.top - containerRect.top; // End at top

          // For nodes in subsequent layers (Gemma -> GPU), simple top-down
          // For Row 2 nodes (ML Service), we need to avoid cutting through Row 1 if possible
          // But strict hierarchy (API -> Row 2) means we just go down.
          // Since it's a grid, API is centered above. Row 2 is below Row 1.

          // Bezier Control Points
          // Pull control points vertically to create specific curve shape
          const dist = Math.abs(y2 - y1);
          const cpY = dist * 0.5; // Control point strength

          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');

          // Use M C command for cubic bezier
          const d = `M ${x1} ${y1} C ${x1} ${y1 + cpY}, ${x2} ${y2 - cpY}, ${x2} ${y2}`;

          path.setAttribute('d', d);
          path.classList.add('connector-path');
          path.setAttribute('id', `conn-${startId}-${endId}`);

          svg.appendChild(path);

          // Add hover listeners
          const nodes = [startEl, endEl];
          nodes.forEach(node => {
            node.addEventListener('mouseenter', () => {
              path.classList.add('active');
              startEl.classList.add('active-pulse');
              endEl.classList.add('active-pulse');
            });
            node.addEventListener('mouseleave', () => {
              path.classList.remove('active');
              startEl.classList.remove('active-pulse');
              endEl.classList.remove('active-pulse');
            });
          });
        });
      }

      // Initial draw with small delay to ensure layout stable
      setTimeout(drawConnections, 100);

      // Redraw on resize
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(drawConnections, 100);
      });
    });
  </script>
</body>

</html>